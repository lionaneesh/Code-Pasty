{% extends "base.html" %}
	{% block title %}Code Pasty | {{pasty.Name}}{% endblock %}
	{% block container %}
		<div class='span12'>
		    <a href="/"><i style="float: left; margin: 10px;" class="icon-backward"></i></a>
		    <div style="float: right">
		    <g:plusone size="tall" href="/pasty/{{pasty.key().id()}}"></g:plusone>
		    </div>
		    <h1>{{pasty.Name}}</h1>
		    {% if is_owner %}
		    <p><a href="/pasty/delete/{{pasty.key()}}">Delete</a></p>
		    {% endif %}
		    <pre class="prettyprint linenums">{{pasty.Content}}</pre>
		</div>
	{% endblock %}

    {% block extra_js %}
    <script type="text/javascript">
    $(window).load(function() {
        $("li").each(function(index) {
            $(this).attr("class", "L"+index)
        });
    });
    $(window).load(function() {
    var lineNos = [];
    {% for comment in comments %}
        if ($("li.L{{comment.LineNo}}").prev('.icon-bullhorn').length == 0) {
            $("li.L{{comment.LineNo}}").before("<i class='icon-bullhorn' id='comment-markers'></i>");
        }
        $("li.L{{comment.LineNo}}").append("<div style='display: none;' class='toggleMe' id='comment'><p><span class='comment-author'>{{comment.User.nickname()}}</span><span class='comment-content'> - {{comment.Content}}</span></p><br></div>");
        $("li.L{{comment.LineNo}}").attr("id", "toggleContainer")
    {% endfor %}
    });
    
    $(window).load(function() {
       $('li').after('<form style="display: none;" class="form-inline add-comment" method="post"><input type="text" {% if not logged_in %}disabled{% endif %} name="comment" class="input-large" placeholder="Add your comment"><button type="submit" class="btn" {% if not logged_in %}disabled{% endif %}>Comment</button></form>'); 
    });
    </script>
    
    <script>
    $(window).load(function() {
        $("li").click(function() {
            $(this).children('.toggleMe').toggle();
            var lineno = $(this).attr("class").substr(1);
            $(this).next('.form-inline').attr("action", "/add_comment/{{pasty.key().id()}}/" + lineno);
            $(this).next('.form-inline').toggle();
        });
    });
    </script>
    {% endblock %}